(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{248:function(t,a,s){"use strict";s.r(a);var n=s(0),e=Object(n.a)({},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"构建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#构建","aria-hidden":"true"}},[t._v("#")]),t._v(" 构建")]),t._v(" "),s("h2",{attrs:{id:"webpack"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#webpack","aria-hidden":"true"}},[t._v("#")]),t._v(" webpack")]),t._v(" "),s("h3",{attrs:{id:"entry、output"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#entry、output","aria-hidden":"true"}},[t._v("#")]),t._v(" entry、output")]),t._v(" "),s("p",[t._v("多入口配置")]),t._v(" "),s("h3",{attrs:{id:"loader"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#loader","aria-hidden":"true"}},[t._v("#")]),t._v(" loader")]),t._v(" "),s("p",[t._v("对指定文件自定义编译，多个loader流式工作")]),t._v(" "),s("h4",{attrs:{id:"使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用","aria-hidden":"true"}},[t._v("#")]),t._v(" 使用")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("config "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tentry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\toutput"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\tmodule"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\trules"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Rule[]")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t\ttest"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token regex"}},[t._v("/xx.ext/")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t\tuse"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Loader[]")]),t._v("\n\t\t\t\t\t"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'loader-a'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t\t\t\tloader"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'loader-b'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t\t\t\toption"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t\t\t\tquery"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("编译过程中遇到匹配某rule的test的文件，会使用rule的use中设置的loader（可以是多个loader，从后往前）来加载这个文件。loader从node_module里的对应loader名调用。")]),t._v(" "),s("h4",{attrs:{id:"编写"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#编写","aria-hidden":"true"}},[t._v("#")]),t._v(" 编写")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("module"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("content"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" map"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" meta"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// do sth")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" newContent"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("或者异步使用")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("module"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("content"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" map"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" meta"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// do sth")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("callback")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("newContent"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("babel-loader（文本loader）：")]),t._v(" "),s("p",[t._v("得到js文件的文本内容content，将其解析成ast，重新组织语法，再生成新的字符串newContent返回")]),t._v(" "),s("p",[t._v("file-loader（二进制loader）：")]),t._v(" "),s("p",[t._v("文件内容content为二进制数据。引用webpack自带的loader-utils库，调用其"),s("code",[t._v("interpolateName")]),t._v("方法得到其hash名，调用"),s("code",[t._v("this.emitFile")]),t._v("把二进制content生成新file输出到output指定的目录下，最终结合config中的publicPath得到新file的可访问路径，最终组合成"),s("code",[t._v("module.exports = fileOutputPath")]),t._v("格式的数据返回")]),t._v(" "),s("h3",{attrs:{id:"plugin"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#plugin","aria-hidden":"true"}},[t._v("#")]),t._v(" plugin")]),t._v(" "),s("p",[t._v("插手构建过程，在complition各阶段添加钩子函数来改变构建逻辑")]),t._v(" "),s("h4",{attrs:{id:"使用-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用-2","aria-hidden":"true"}},[t._v("#")]),t._v(" 使用")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("config "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tentry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\toutput"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\tplugins"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SomePlugin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h4",{attrs:{id:"编写-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#编写-2","aria-hidden":"true"}},[t._v("#")]),t._v(" 编写")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("constructor")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 拿到用户定义的options")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apply")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("compiler"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 插件安装时调用一次，拿到compiler对象（提供webpack全局配置信息）")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 可以从compiler的hooks回调拿到compilation对象（每次文件变动重新生成，提供本次资源相关信息）")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 在compiler和compilation的各类hooks\b（基于tapable）绑定自定义事件")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\t\t\t\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h4",{attrs:{id:"defineplugin"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#defineplugin","aria-hidden":"true"}},[t._v("#")]),t._v(" definePlugin")]),t._v(" "),s("p",[t._v("一般用于定义一些全局字段，和process.env（模仿node环境）。")]),t._v(" "),s("p",[t._v("这些配置是在编译阶段静态直接转换，而非生成全局变量，比如模块中"),s("code",[t._v("process.env.NODE_ENV")]),t._v("编译后会直接被替换为定义的值，而"),s("code",[t._v("process.env['NODE' + '_ENV']")]),t._v("则不会")]),t._v(" "),s("h3",{attrs:{id:"代码分割"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#代码分割","aria-hidden":"true"}},[t._v("#")]),t._v(" 代码分割")]),t._v(" "),s("p",[t._v("optimization.splitChunks 整体控制模块的独立打包规则，比如提取多页项目的公共依赖")]),t._v(" "),s("p",[t._v("cacheGroups.vendor 分割出不常改变的公共文件单独打包，利于被浏览器缓存")]),t._v(" "),s("p",[t._v("页面中import('./module') 手动分割模块，webpack编译时会单独打包此module")]),t._v(" "),s("p",[t._v("可用webpack-bundle-analyzer分析打包结果")]),t._v(" "),s("h3",{attrs:{id:"编译速度优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#编译速度优化","aria-hidden":"true"}},[t._v("#")]),t._v(" 编译速度优化")]),t._v(" "),s("p",[t._v("ddl：ddl.config打包公共文件生成manifest，config引用这个manifest，省去对公共文件再次打包的时间")]),t._v(" "),s("h2",{attrs:{id:"rollup"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#rollup","aria-hidden":"true"}},[t._v("#")]),t._v(" rollup")]),t._v(" "),s("p",[t._v("更纯粹的打包工具，适合库而非应用（app）")]),t._v(" "),s("h2",{attrs:{id:"gulp"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#gulp","aria-hidden":"true"}},[t._v("#")]),t._v(" gulp")]),t._v(" "),s("p",[t._v("流式任务")]),t._v(" "),s("h2",{attrs:{id:"代码体积优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#代码体积优化","aria-hidden":"true"}},[t._v("#")]),t._v(" 代码体积优化")]),t._v(" "),s("p",[t._v("treeshaking去除无用代码，前提需要模块无副作用")]),t._v(" "),s("p",[t._v("模块扁平化，比如能直接返回值的模块，引用它时直接引用返回值，而不是引用模块")]),t._v(" "),s("p",[t._v("单例模式引用模块")]),t._v(" "),s("p",[t._v("提升各模块中的polyfill函数来共用")]),t._v(" "),s("p",[t._v("代码压缩")]),t._v(" "),s("h2",{attrs:{id:"babel"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#babel","aria-hidden":"true"}},[t._v("#")]),t._v(" babel")]),t._v(" "),s("p",[t._v("和polyfill关系：babel只转语法，polyfill拓展原型和全局对象")]),t._v(" "),s("p",[t._v("原理：text => tokens => ast => ast(transformed) => text")]),t._v(" "),s("h3",{attrs:{id:"babel如何直接运行于浏览器？"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#babel如何直接运行于浏览器？","aria-hidden":"true"}},[t._v("#")]),t._v(" babel如何直接运行于浏览器？")]),t._v(" "),s("p",[t._v("以此版本 https://unpkg.com/babel-standalone@6.26.0/babel.js 的babel为例：")]),t._v(" "),s("ol",[s("li",[t._v("监听"),s("code",[t._v("DOMContentLoaded")]),t._v("事件，事件触发后会选取所有"),s("code",[t._v("type")]),t._v("为"),s("code",[t._v("text/jsx")]),t._v("和"),s("code",[t._v("text/babel")]),t._v("的"),s("code",[t._v("script")]),t._v("存入jsxScripts数组。")]),t._v(" "),s("li",[t._v("遍历数组，将"),s("code",[t._v("scriptEl.innerHTML")]),t._v("作为源码调用babel核心方法编译为结果代码（带"),s("code",[t._v("src")]),t._v("的"),s("code",[t._v("script")]),t._v("用ajax异步获取content作为源码，在回调中处理编译）。")]),t._v(" "),s("li",[t._v("编译完成后新建"),s("code",[t._v("script")]),t._v("元素，将"),s("code",[t._v("scriptEl.text")]),t._v("设置为结果代码，"),s("code",[t._v("append")]),t._v("到"),s("code",[t._v("headEl")]),t._v("，此时浏览器会自动执行该"),s("code",[t._v("script")]),t._v("。")])])])},[],!1,null,null,null);a.default=e.exports}}]);